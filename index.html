<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Suite - Alat Bantu Edit Gambar AI</title>
    
    <meta name="description" content="AI Image Suite: Alat bantu AI terlengkap untuk menggabungkan gambar, product photoshoot, foto model, dan perbaikan foto jadul."/>
    <meta name="keywords" content="AI image generator, edit foto AI, gabung gambar, product photoshoot AI, wedding generator"/>
    <meta name="author" content="Asnawi Darsa"/>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }
        .tab-btn.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .upload-box {
            border: 2px dashed #4b5563;
            background-color: #1f2937;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            height: 250px;
            cursor: pointer; /* Menambahkan cursor: pointer untuk upload box */
        }
        .upload-box img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .upload-box input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .output-image-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            aspect-ratio: 1 / 1; /* Memastikan output berbentuk kotak/proporsional */
        }
        .output-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .output-image-container .download-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .output-image-container:hover .download-btn {
            opacity: 1;
        }
    </style>
</head>
<body class="text-gray-200 p-4 sm:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-bold bg-gradient-to-r from-indigo-400 to-cyan-400 text-transparent bg-clip-text">AI Image Suite</h1>
            <p class="text-gray-400 mt-2">Alat bantu AI untuk semua kebutuhan edit gambar Anda.</p>
            <p class="text-gray-500 text-sm mt-2">developed by Asnawi Darsa | V. 001</p>
        </header>

        <nav role="tablist" class="flex flex-wrap justify-center gap-2 sm:gap-4 mb-10">
            <button role="tab" aria-selected="true" class="tab-btn active text-sm sm:text-base font-medium py-2 px-4 rounded-lg border border-gray-600 transition" data-tab="combine">Gabungkan Gambar</button>
            <button role="tab" aria-selected="false" class="tab-btn text-sm sm:text-base font-medium py-2 px-4 rounded-lg border border-gray-600 transition" data-tab="product">Product Photoshoot</button>
            <button role="tab" aria-selected="false" class="tab-btn text-sm sm:text-base font-medium py-2 px-4 rounded-lg border border-gray-600 transition" data-tab="model">Buat Foto Model</button>
            <button role="tab" aria-selected="false" class="tab-btn text-sm sm:text-base font-medium py-2 px-4 rounded-lg border border-gray-600 transition" data-tab="wedding">Wedding Generator</button>
            <button role="tab" aria-selected="false" class="tab-btn text-sm sm:text-base font-medium py-2 px-4 rounded-lg border border-gray-600 transition" data-tab="edit">Edit Foto</button>
        </nav>

        <main>
            <section id="combine" role="tabpanel" class="tab-content active">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-xl space-y-6">
                        <h2 class="text-xl font-semibold text-white">Input Gambar & Prompt</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="upload-box" id="combine-preview1-container">
                                <img id="combine-preview1" class="hidden" alt="Pratinjau Gambar 1"/>
                                <div id="combine-placeholder1">
                                    <svg class="w-12 h-12 mx-auto text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    <p class="mt-2 text-sm text-gray-400">Upload Gambar 1</p>
                                </div>
                                <input type="file" id="combine-img1" accept="image/*" aria-label="Upload Gambar Pertama">
                            </div>
                            <div class="upload-box" id="combine-preview2-container">
                               <img id="combine-preview2" class="hidden" alt="Pratinjau Gambar 2"/>
                                <div id="combine-placeholder2">
                                     <svg class="w-12 h-12 mx-auto text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    <p class="mt-2 text-sm text-gray-400">Upload Gambar 2</p>
                                </div>
                                <input type="file" id="combine-img2" accept="image/*" aria-label="Upload Gambar Kedua">
                            </div>
                        </div>
                        <div>
                            <label for="combine-prompt" class="block mb-2 font-medium">Prompt</label>
                            <textarea id="combine-prompt" rows="3" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2.5 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Contoh: Gabungkan dua gambar ini menjadi sebuah lukisan cat minyak fantasi..."></textarea>
                        </div>
                        <button id="combine-generate" class="w-full bg-indigo-600 hover:bg-indigo-700 font-bold py-3 px-4 rounded-lg transition" aria-label="Generate Gabungkan Gambar">Generate</button>
                    </div>
                    <div id="combine-output" class="bg-gray-800 p-6 rounded-lg min-h-[300px] flex items-center justify-center shadow-xl">
                         <div class="text-center text-gray-500">
                             <p>Hasil gambar akan muncul di sini</p>
                             <p class="text-sm">(4 gambar dengan gaya berbeda)</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="product" role="tabpanel" class="tab-content">
                 <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-xl space-y-6">
                        <h2 class="text-xl font-semibold text-white">Input Orang & Produk</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="upload-box" id="product-preview1-container">
                                <img id="product-preview1" class="hidden" alt="Pratinjau Foto Orang"/>
                                <div id="product-placeholder1">
                                    <svg class="w-12 h-12 mx-auto text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    <p class="mt-2 text-sm text-gray-400">Upload Foto Orang</p>
                                </div>
                                <input type="file" id="product-img1" accept="image/*" aria-label="Upload Foto Model">
                            </div>
                            <div class="upload-box" id="product-preview2-container">
                               <img id="product-preview2" class="hidden" alt="Pratinjau Foto Produk"/>
                                <div id="product-placeholder2">
                                     <svg class="w-12 h-12 mx-auto text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                                    <p class="mt-2 text-sm text-gray-400">Upload Foto Produk</p>
                                </div>
                                <input type="file" id="product-img2" accept="image/*" aria-label="Upload Foto Produk">
                            </div>
                        </div>
                        <div>
                            <label for="product-prompt" class="block mb-2 font-medium">Prompt</label>
                            <textarea id="product-prompt" rows="3" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2.5" placeholder="Contoh: Buat foto orang ini sedang menggunakan produk di pantai saat matahari terbenam..."></textarea>
                        </div>
                        <button id="product-generate" class="w-full bg-indigo-600 hover:bg-indigo-700 font-bold py-3 px-4 rounded-lg transition" aria-label="Generate Product Photoshoot">Generate</button>
                    </div>
                    <div id="product-output" class="bg-gray-800 p-6 rounded-lg min-h-[300px] flex items-center justify-center shadow-xl">
                        <div class="text-center text-gray-500">Hasil gambar akan muncul di sini</div>
                    </div>
                </div>
            </section>

            <section id="model" role="tabpanel" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-xl space-y-6">
                         <h2 class="text-xl font-semibold text-white">Input Foto & Prompt</h2>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="upload-box" id="model-preview1-container">
                                <img id="model-preview1" class="hidden" alt="Pratinjau Foto Anda"/>
                                <div id="model-placeholder1">
                                    <svg class="w-12 h-12 mx-auto text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    <p class="mt-2 text-sm text-gray-400">Upload Foto Anda</p>
                                </div>
                                <input type="file" id="model-img1" accept="image/*" aria-label="Upload Foto Model">
                            </div>
                        </div>
                        <div>
                            <label for="model-prompt" class="block mb-2 font-medium">Prompt</label>
                            <textarea id="model-prompt" rows="3" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2.5" placeholder="Contoh: Ubah orang ini menjadi model profesional di jalanan kota Tokyo..."></textarea>
                        </div>
                        <button id="model-generate" class="w-full bg-indigo-600 hover:bg-indigo-700 font-bold py-3 px-4 rounded-lg transition" aria-label="Generate Foto Model">Generate</button>
                    </div>
                    <div id="model-output" class="bg-gray-800 p-6 rounded-lg min-h-[300px] flex items-center justify-center shadow-xl">
                        <div class="text-center text-gray-500">Hasil gambar akan muncul di sini</div>
                    </div>
                </div>
            </section>

            <section id="wedding" role="tabpanel" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-xl space-y-6">
                        <h2 class="text-xl font-semibold text-white">Input Foto Pasangan & Prompt</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="upload-box" id="wedding-preview1-container">
                                <img id="wedding-preview1" class="hidden" alt="Pratinjau Foto Pertama"/>
                                <div id="wedding-placeholder1">
                                    <svg class="w-12 h-12 mx-auto text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    <p class="mt-2 text-sm text-gray-400">Upload Foto 1</p>
                                </div>
                                <input type="file" id="wedding-img1" accept="image/*" aria-label="Upload Foto Pasangan Pertama">
                            </div>
                            <div class="upload-box" id="wedding-preview2-container">
                               <img id="wedding-preview2" class="hidden" alt="Pratinjau Foto Kedua"/>
                                <div id="wedding-placeholder2">
                                     <svg class="w-12 h-12 mx-auto text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    <p class="mt-2 text-sm text-gray-400">Upload Foto 2</p>
                                </div>
                                <input type="file" id="wedding-img2" accept="image/*" aria-label="Upload Foto Pasangan Kedua">
                            </div>
                        </div>
                        <div>
                            <label for="wedding-prompt" class="block mb-2 font-medium">Prompt</label>
                            <textarea id="wedding-prompt" rows="3" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2.5" placeholder="Contoh: Buat foto pernikahan untuk pasangan ini dengan tema fantasi di hutan ajaib..."></textarea>
                        </div>
                        <button id="wedding-generate" class="w-full bg-indigo-600 hover:bg-indigo-700 font-bold py-3 px-4 rounded-lg transition" aria-label="Generate Wedding Photo">Generate</button>
                    </div>
                    <div id="wedding-output" class="bg-gray-800 p-6 rounded-lg min-h-[300px] flex items-center justify-center shadow-xl">
                        <div class="text-center text-gray-500">Hasil gambar akan muncul di sini</div>
                    </div>
                </div>
            </section>

            <section id="edit" role="tabpanel" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-xl space-y-6">
                        <h2 class="text-xl font-semibold text-white">Input Foto & Pilihan Edit</h2>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="upload-box" id="edit-preview1-container">
                                <img id="edit-preview1" class="hidden" alt="Pratinjau Foto"/>
                                <div id="edit-placeholder1">
                                    <svg class="w-12 h-12 mx-auto text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    <p class="mt-2 text-sm text-gray-400">Upload Foto</p>
                                </div>
                                <input type="file" id="edit-img1" accept="image/*" aria-label="Upload Foto untuk Diedit">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button id="edit-remove-bg" class="w-full bg-cyan-600 hover:bg-cyan-700 font-bold py-3 px-4 rounded-lg transition" aria-label="Hapus Background">Hapus Background</button>
                            <button id="edit-restore" class="w-full bg-teal-600 hover:bg-teal-700 font-bold py-3 px-4 rounded-lg transition" aria-label="Perbaiki Foto Jadul">Perbaiki Foto Jadul</button>
                        </div>
                         <p class="text-sm text-center text-gray-400">Fitur Crop dapat dilakukan menggunakan editor gambar bawaan setelah Anda mengunduh hasilnya.</p>
                    </div>
                    <div id="edit-output" class="bg-gray-800 p-6 rounded-lg min-h-[300px] flex items-center justify-center shadow-xl">
                        <div class="text-center text-gray-500">Hasil editan akan muncul di sini</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // =================================================================
        // PERBAIKAN PENTING: API KEY & URL DIPINDAHKAN KE LINGKUP GLOBAL SCRIPT
        // Ini memperbaiki error 'API_URL is not defined'.
        // CATATAN KEAMANAN: Jangan publikasikan API Key ini di repositori GitHub!
        // =================================================================
        const API_KEY = "AIzaSyDDy2isEeY0OwBF9qQgUh8aYH-pX_asOBs"; 
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${API_KEY}`;
        // =================================================================

        // Helper Functions (Diletakkan di luar DOMContentLoaded agar bisa diakses oleh fungsi generate)
        async function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function showLoader(outputElement) {
            outputElement.innerHTML = '<div class="loader mx-auto"></div>';
        }

        function showError(outputElement, message) {
            outputElement.innerHTML = `<div class="text-center text-red-400 p-4 rounded-lg bg-gray-700/50">${message}</div>`;
        }

        function displayResults(outputElement, imagesBase64) {
            outputElement.innerHTML = '';
            const grid = document.createElement('div');
            // Untuk output tunggal (edit), gunakan 1 kolom, untuk output ganda (generate) gunakan 2 kolom.
            const columnClass = imagesBase64.length === 1 ? 'grid-cols-1 max-w-lg mx-auto' : 'grid-cols-2';
            grid.className = `grid ${columnClass} gap-4 w-full`;
            
            imagesBase64.forEach((base64Data, index) => {
                const container = document.createElement('div');
                container.className = 'output-image-container';

                const img = document.createElement('img');
                img.src = `data:image/png;base64,${base64Data}`;
                img.alt = `Generated Image ${index + 1}`;
                img.className = 'w-full h-full object-cover';

                const downloadBtn = document.createElement('button');
                downloadBtn.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>`;
                downloadBtn.className = 'download-btn bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700 transition';
                downloadBtn.onclick = () => downloadImage(`data:image/png;base64,${base64Data}`, `ai-image-suite-${Date.now()}.png`);
                
                container.appendChild(img);
                container.appendChild(downloadBtn);
                grid.appendChild(container);
            });

            outputElement.appendChild(grid);
        }

        function downloadImage(dataUrl, filename) {
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        async function callApi(prompt, images, outputElementId, isSingleOutput = false, promptVariations = null) {
            const outputElement = document.getElementById(outputElementId);
            
            if (images.some(img => !img)) {
                showError(outputElement, 'Harap unggah semua gambar yang diperlukan.');
                return;
            }
            if (!prompt && !isSingleOutput) {
                 showError(outputElement, 'Harap isi prompt untuk menghasilkan gambar.');
                return;
            }

            showLoader(outputElement);

            try {
                const imageParts = await Promise.all(
                    images.filter(img => img).map(async (file) => {
                        const base64Data = await fileToBase64(file);
                        return {
                            inlineData: {
                                mimeType: file.type,
                                data: base64Data
                            }
                        };
                    })
                );
                
                const requests = isSingleOutput ? [0] : [0, 1, 2, 3];
                const generatedImages = [];

                for (const i of requests) {
                    let finalPrompt = prompt;
                    if (!isSingleOutput) {
                        if (promptVariations && promptVariations.length === requests.length) {
                            finalPrompt = `${prompt}, ${promptVariations[i]}`;
                        } else {
                            // Default variation added for general multi-image generation
                            const styleSuffixes = [
                                '(sinematik, pencahayaan dramatis)', 
                                '(gaya lukisan cat air, warna-warna lembut)', 
                                '(gaya fotografi studio, tajam dan detail)', 
                                '(gaya seni digital fantasi, HDR)'
                            ];
                            finalPrompt = `${prompt}, ${styleSuffixes[i] || ''}`;
                        }
                    }

                    const payload = {
                        contents: [{
                            parts: [{ text: finalPrompt }, ...imageParts]
                        }],
                        // Menambahkan konfigurasi untuk mendapatkan hasil yang lebih baik
                        config: {
                            imageGenerationConfig: {
                                numberOfImages: 1, // Kita minta 1 per request, lalu kita loop
                                quality: "high", 
                                aspect_ratio: "1:1", // Default ke rasio kotak
                            }
                        }
                    };

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`API Error: ${response.status} - ${errorText.substring(0, 100)}...`);
                    }

                    const result = await response.json();
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    
                    if (base64Data) {
                       generatedImages.push(base64Data);
                    } else {
                       console.warn(`Tidak ada gambar yang dihasilkan untuk permintaan ke-${i+1}`);
                    }
                }

                if (generatedImages.length > 0) {
                    displayResults(outputElement, generatedImages);
                } else {
                    throw new Error('Gagal menghasilkan gambar dari API. Coba ganti prompt Anda.');
                }


            } catch (error) {
                console.error('Error:', error);
                showError(outputElement, `Terjadi kesalahan: ${error.message}. Pastikan API Key Anda valid.`);
            }
        }


        // =================================================================
        // DOM LOADED LOGIC (Semua manipulasi DOM harus di sini)
        // =================================================================
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.tab-content');

            // --- 1. Tab Logic ---
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.classList.remove('active'));
                    
                    // Update ARIA for accessibility
                    tabs.forEach(t => t.setAttribute('aria-selected', 'false'));

                    tab.classList.add('active');
                    tab.setAttribute('aria-selected', 'true');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });

            // --- 2. File Preview Logic ---
            function setupImagePreview(inputId, previewId, placeholderId) {
                const input = document.getElementById(inputId);
                const preview = document.getElementById(previewId);
                const placeholder = document.getElementById(placeholderId);

                input.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            preview.src = e.target.result;
                            preview.classList.remove('hidden');
                            if(placeholder) placeholder.classList.add('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Setup previews for all tools
            setupImagePreview('combine-img1', 'combine-preview1', 'combine-placeholder1');
            setupImagePreview('combine-img2', 'combine-preview2', 'combine-placeholder2');
            setupImagePreview('product-img1', 'product-preview1', 'product-placeholder1');
            setupImagePreview('product-img2', 'product-preview2', 'product-placeholder2');
            setupImagePreview('model-img1', 'model-preview1', 'model-placeholder1');
            setupImagePreview('wedding-img1', 'wedding-preview1', 'wedding-placeholder1');
            setupImagePreview('wedding-img2', 'wedding-preview2', 'wedding-placeholder2');
            setupImagePreview('edit-img1', 'edit-preview1', 'edit-placeholder1');

            // --- 3. Event Listeners for Generate Buttons ---
            document.getElementById('combine-generate').addEventListener('click', () => {
                const prompt = document.getElementById('combine-prompt').value;
                const img1 = document.getElementById('combine-img1').files[0];
                const img2 = document.getElementById('combine-img2').files[0];
                callApi(prompt, [img1, img2], 'combine-output');
            });
            
            document.getElementById('product-generate').addEventListener('click', () => {
                const prompt = document.getElementById('product-prompt').value;
                const img1 = document.getElementById('product-img1').files[0];
                const img2 = document.getElementById('product-img2').files[0];
                callApi(prompt, [img1, img2], 'product-output');
            });

            document.getElementById('model-generate').addEventListener('click', () => {
                const prompt = document.getElementById('model-prompt').value;
                const img1 = document.getElementById('model-img1').files[0];
                const poses = [
                    'dengan pose badan menyudut (angled body pose)', 
                    'dengan pose melihat ke belakang lewat bahu (looking over the shoulder pose)', 
                    'dengan pose S-curve', 
                    'dengan pose duduk (sitting pose)'
                ];
                callApi(prompt, [img1], 'model-output', false, poses);
            });

            document.getElementById('wedding-generate').addEventListener('click', () => {
                const prompt = document.getElementById('wedding-prompt').value;
                const img1 = document.getElementById('wedding-img1').files[0];
                const img2 = document.getElementById('wedding-img2').files[0];
                callApi(prompt, [img1, img2], 'wedding-output');
            });

            // --- 4. Event Listeners for Edit Buttons ---
            document.getElementById('edit-remove-bg').addEventListener('click', () => {
                const img1 = document.getElementById('edit-img1').files[0];
                const prompt = 'Hapus background dari gambar ini dan buat menjadi transparan. Fokus pada objek utama.';
                callApi(prompt, [img1], 'edit-output', true); 
            });

            document.getElementById('edit-restore').addEventListener('click', () => {
                const img1 = document.getElementById('edit-img1').files[0];
                const prompt = 'Perbaiki foto lama ini. Tingkatkan resolusi, perjelas detail, dan perbaiki warna yang pudar atau rusak.';
                callApi(prompt, [img1], 'edit-output', true); 
            });
        });
    </script>
</body>
</html>

